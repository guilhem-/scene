---
- name: Skip Route53 if no domain configured
  ansible.builtin.debug:
    msg: "Skipping DNS configuration - no domain or zone ID configured"
  when: (domain_name | default('') | length == 0) or (route53_zone_id | default('') | length == 0)

- name: Create Route53 A record
  amazon.aws.route53:
    state: present
    hosted_zone_id: "{{ route53_zone_id }}"
    record: "{{ domain_name }}"
    type: A
    ttl: 300
    value: "{{ ec2_public_ip }}"
    overwrite: yes
    wait: yes
  when:
    - domain_name | default('') | length > 0
    - route53_zone_id | default('') | length > 0
    - ec2_public_ip | default('') | length > 0
  register: dns_result

- name: Display DNS result
  ansible.builtin.debug:
    msg: "DNS record created: {{ domain_name }} -> {{ ec2_public_ip }}"
  when:
    - domain_name | default('') | length > 0
    - route53_zone_id | default('') | length > 0
    - ec2_public_ip | default('') | length > 0

- name: Wait for DNS propagation
  ansible.builtin.debug:
    msg: "Note: DNS propagation may take a few minutes. You can check with: dig {{ domain_name }}"
  when:
    - domain_name | default('') | length > 0
    - route53_zone_id | default('') | length > 0
